/*
 * Name: SewisePlayer Screenshot plugin
 * Author: keyun
 * Website: http://player.sewise.com
 * Date: May 18, 2016
 * Copyright: 2013-2016, Sewise
 * Mail: keyun@sewise.com
 * - Licensed under the MIT license
 * 
 */

!function(a,b){var c=a.SewiseScreenshot=function(){this.player=null,this.video=null,this.playerContainer=null,this.canvas=null,this.context=null,this.scale=1,this.keyObj={}};c.prototype.init=function(a){var b=this;this.player=a,"flash"===this.player.playController.playerType?(this.player.playController.playVars.accelerate="disable",this.player.playController.playVars.useSceenshot="enable"):(this.video=this.player.getVideo(),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.video.addEventListener("canplay",function(){b.regisKeybordEvent()}))},c.prototype.regisKeybordEvent=function(){var a=this;b(document).keydown(function(b){a.keyObj[b.keyCode]=!0,a.keyObj[67]&&a.keyObj[90]&&a.keyObj[88]&&(a.keyObj={},a.shot())}),b(document).keyup(function(b){a.keyObj[b.keyCode]=!1})},c.prototype.shot=function(){if("flash"===this.player.playController.playerType);else{this.canvas.width=b(this.video).width()*this.scale,this.canvas.height=b(this.video).height()*this.scale,this.context.drawImage(this.video,0,0,this.canvas.width,this.canvas.height);var a=this.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),c="shot_"+(new Date).getTime()+".png";this.saveImageFile(a,c)}},c.prototype.saveImageFile=function(a,b){var c=document.createElementNS("http://www.w3.org/1999/xhtml","a");c.href=a,c.download=b;var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)}}(window,window.jQuery);